import{S as e,i as a,s,e as t,c as r,a as d,d as n,b as o,f as l,g as c,l as i,h as u,u as h,t as f,j as p,k as v,m,n as g,o as b,p as y,w,q as x,r as M,v as T,x as I,y as D,z as E,A as $,B as S,C as k,D as B,E as C,F as V,G as q,H as A,I as R,J as N,K as H}from"./client.edab0b18.js";function P(e){let a,s,v,m,g;const y=e[2].default,w=b(y,e,e[1],null);return{c(){a=t("div"),s=t("div"),w&&w.c(),this.h()},l(e){a=r(e,"DIV",{class:!0});var t=d(a);s=r(t,"DIV",{class:!0});var o=d(s);w&&w.l(o),o.forEach(n),t.forEach(n),this.h()},h(){o(s,"class","modal svelte-y6bmyh"),o(a,"class","backdrop svelte-y6bmyh")},m(t,r){l(t,a,r),c(a,s),w&&w.m(s,null),v=!0,m||(g=i(a,"click",u(e[3])),m=!0)},p(e,a){w&&w.p&&2&a&&h(w,y,e,e[1],a,null,null)},i(e){v||(f(w,e),v=!0)},o(e){p(w,e),v=!1},d(e){e&&n(a),w&&w.d(e),m=!1,g()}}}function O(e){let a,s,t=e[0]&&P(e);return{c(){t&&t.c(),a=v()},l(e){t&&t.l(e),a=v()},m(e,r){t&&t.m(e,r),l(e,a,r),s=!0},p(e,[s]){e[0]?t?(t.p(e,s),1&s&&f(t,1)):(t=P(e),t.c(),f(t,1),t.m(a.parentNode,a)):t&&(m(),p(t,1,1,(()=>{t=null})),g())},i(e){s||(f(t),s=!0)},o(e){p(t),s=!1},d(e){t&&t.d(e),e&&n(a)}}}function G(e,a,s){let{$$slots:t={},$$scope:r}=a,{showModal:d=!1}=a;return e.$$set=e=>{"showModal"in e&&s(0,d=e.showModal),"$$scope"in e&&s(1,r=e.$$scope)},[d,r,t,function(a){y(e,a)}]}class U extends e{constructor(e){super(),a(this,e,G,O,s,{showModal:0})}}const{subscribe:F,set:J,update:W}=w({serial:"",baseAddr:"",channelIndex:"",totalChannels:"",randomFact:"Svelte can be easy"}),j={subscribe:F,set:J,update:W,setSerial:e=>W((a=>(a.serial=e,a))),setBaseAddr:e=>W((a=>(a.baseAddr=e,a))),setChannelIndex:e=>W((a=>(a.channelIndex=e,a))),setTotalChannels:e=>W((a=>(a.totalChannels=e,a)))},z=e=>{let a="Not Specified";if(!Number.isInteger(e))throw"type provided not valid integer";switch(e){case 1:a="T750 Hub";break;case 2:a="T750 Ann";break;case 3:a="T750 I/O";break;case 4:a="T750 Display";break;case 5:a="T750 Sampler";break;case 6:a="T650 Hub";break;case 7:a="T750B";break;case 8:a="T750B Display";break;case 9:a="T750BAV Display";break;case 10:a="T635 Display";break;case 11:a="T635+ Mini Hub (B1)";break;case 12:a="T635 Micro Mini Hub (B2)";break;case 13:a="T635 Mini Hub (B3)";break;case 14:a="T635 Mini Hub (B4)";break;case 15:a="ESP32 Dongle";break;case 16:a="T750+ Hub"}return a};function K(e,a){let s=0;return s|=a<<8,s|=e,s}var L;function Q(e){console.log("Connection closed"),setTimeout(initWebSocket,2e3)}function X(e){Y.onMsgArrived(e)}const Y={queuedMsgs:[],sentMsgs:[],busy:!1,onMsgArrived:function(e){let a="",s=JSON.parse(e.data);this.sentMsgs.forEach((function(e,t){e.id===s.id&&(e.success(s),a=e.id)})),this.sentMsgs=this.sentMsgs.filter((e=>e.id!==a)),0!=this.queuedMsgs.length&&this.sendNextMessage()},init:function(){setInterval((()=>{let e=Date.now();this.sentMsgs.forEach((function(a,s){a.timestamp-e>5e3&&a.fail("No response received, expired: ",a)})),this.sentMsgs=this.sentMsgs.filter((a=>a.timestamp-e<5e3))}),800)},queueMsg:function(e){return new Promise(((a,s)=>{setTimeout((()=>{this.queuedMsgs.push({id:String("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var a=16*Math.random()|0;return("x"==e?a:3&a|8).toString(16)}))),timestamp:-1,msg:e,success:e=>a(e),fail:e=>s(e)}),this.sendNextMsg()}),20)}))},sendNextMsg:function(){if(this.queuedMsgs.length&&!this.busy){this.busy=!0;let e=this.queuedMsgs.shift();L.send(JSON.stringify({id:e.id,maxTries:e.msg.maxTries,timeout:e.msg.timeout,addr:e.msg.addr,cmd:e.msg.cmd,d1:e.msg.d1,d2:e.msg.d2,d3:e.msg.d3,d4:e.msg.d4})),this.sentMsgs.push(e),this.busy=!1}}},Z={serial:async function(e){let a=await Y.queueMsg({maxTries:3,timeout:200,addr:e.addr,cmd:21,d1:7,d2:0,d3:0,d4:0});if(console.log(a),0!=a.payload.twResCode)throw a;return function(e,a,s){let t,r=0;return r|=s<<16,t=a,t=t<<8&65280,r|=t,r|=255&e,r}(a.payload.d1,a.payload.d2,a.payload.d3)},baseSettings:async function(e){let a=await Y.queueMsg({maxTries:3,timeout:200,addr:e.addr,cmd:21,d1:25,d2:0,d3:0,d4:0});if(0!=a.payload.twResCode)throw a;return{baseAddr:a.payload.d1,channelIndex:a.payload.d2,totalChannels:a.payload.d3}},pcbType:async function(e){let a=await Y.queueMsg({maxTries:3,timeout:200,addr:e.addr,cmd:21,d1:37,d2:0,d3:0,d4:0});if(0!=a.payload.twResCode)throw a;return{pcbType:z(a.payload.d1),addr:a.payload.d2,cable:a.payload.d3}}},_={program:async function(e){let a=await Y.queueMsg({maxTries:3,timeout:200,addr:e.addr,cmd:20,d1:1,d2:0,d3:0,d4:0});if(0!=a.payload.twResCode)throw a;return{version:K(a.payload.d1,a.payload.d2)/1e3,checksum:`0x${K(a.payload.d3,a.payload.d4).toString(16).toUpperCase()}`}},programDate:async function(e){let a=await Y.queueMsg({maxTries:3,timeout:200,addr:e.addr,cmd:20,d1:4,d2:0,d3:0,d4:0});if(0!=a.payload.twResCode)throw a;return new Date(a.payload.d3+2e3,a.payload.d2-1,a.payload.d1).toLocaleDateString()}},ee={serial:async function(e){let a=function(e){let a=new Uint8Array(3);return a[0]=255&e,a[1]=e>>8&255,a[2]=e>>16&255,a}(e.serial),s=await Y.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:121,d1:7,d2:a[0],d3:a[1],d4:a[2]});if(0!=s.payload.twResCode)throw s},baseSettings:async function(e){let a=await Y.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:121,d1:25,d2:e.baseAddr,d3:e.channelIndex,d4:e.totalChannels});if(0!=a.payload.twResCode)throw a}};async function ae(){await(console.log("Trying to open a WebSocket connection..."),(L=new WebSocket("wss://igd-dev.tk/chat")).onclose=Q,L.onmessage=X,new Promise(((e,a)=>{L.onopen=a=>{console.log("ws opened"),e(a)}}))),Y.init()}function se(e){let a,s,u,h,f,p,v,m,g,b,y,w,B,C,V,q,A,R,N,H,P,O,G,U,F,J,W;return{c(){a=t("h3"),s=x("General"),u=M(),h=t("br"),f=M(),p=t("br"),v=M(),m=t("form"),g=t("div"),b=t("div"),y=x("Serial"),w=M(),B=t("input"),C=M(),V=t("div"),q=x("Base Address"),A=M(),R=t("input"),N=M(),H=t("br"),P=M(),O=t("br"),G=M(),U=t("button"),F=x("Apply"),this.h()},l(e){a=r(e,"H3",{class:!0});var t=d(a);s=T(t,"General"),t.forEach(n),u=I(e),h=r(e,"BR",{}),f=I(e),p=r(e,"BR",{}),v=I(e),m=r(e,"FORM",{class:!0});var o=d(m);g=r(o,"DIV",{class:!0});var l=d(g);b=r(l,"DIV",{class:!0});var c=d(b);y=T(c,"Serial"),c.forEach(n),w=I(l),B=r(l,"INPUT",{type:!0,class:!0}),C=I(l),V=r(l,"DIV",{class:!0});var i=d(V);q=T(i,"Base Address"),i.forEach(n),A=I(l),R=r(l,"INPUT",{type:!0,class:!0}),l.forEach(n),N=I(o),H=r(o,"BR",{}),P=I(o),O=r(o,"BR",{}),G=I(o),U=r(o,"BUTTON",{type:!0,class:!0});var x=d(U);F=T(x,"Apply"),x.forEach(n),o.forEach(n),this.h()},h(){o(a,"class","svelte-111vfxd"),o(b,"class","svelte-111vfxd"),o(B,"type","number"),o(B,"class","svelte-111vfxd"),o(V,"class","svelte-111vfxd"),o(R,"type","number"),o(R,"class","svelte-111vfxd"),o(g,"class","inputs svelte-111vfxd"),o(U,"type","submit"),o(U,"class","svelte-111vfxd"),o(m,"class","svelte-111vfxd")},m(t,r){l(t,a,r),c(a,s),l(t,u,r),l(t,h,r),l(t,f,r),l(t,p,r),l(t,v,r),l(t,m,r),c(m,g),c(g,b),c(b,y),c(g,w),c(g,B),D(B,e[0]),c(g,C),c(g,V),c(V,q),c(g,A),c(g,R),D(R,e[1]),c(m,N),c(m,H),c(m,P),c(m,O),c(m,G),c(m,U),c(U,F),J||(W=[i(B,"input",e[4]),i(R,"input",e[5]),i(m,"submit",E(e[2]))],J=!0)},p(e,[a]){1&a&&$(B.value)!==e[0]&&D(B,e[0]),2&a&&$(R.value)!==e[1]&&D(R,e[1])},i:S,o:S,d(e){e&&n(a),e&&n(u),e&&n(h),e&&n(f),e&&n(p),e&&n(v),e&&n(m),J=!1,k(W)}}}function te(e,a,s){let t;B(e,j,(e=>s(6,t=e)));let r=t.serial,d=t.baseAddr,n=t.channelIndex,o=t.totalChannels,{closeModal:l}=a;return e.$$set=e=>{"closeModal"in e&&s(3,l=e.closeModal)},[r,d,async()=>{try{await ee.serial({addr:255,serial:r}),j.setSerial(r),await ee.baseSettings({addr:255,baseAddr:d,channelIndex:n,totalChannels:o}),j.setBaseAddr(d)}catch(e){console.log(e)}l()},l,function(){r=$(this.value),s(0,r)},function(){d=$(this.value),s(1,d)}]}class re extends e{constructor(e){super(),a(this,e,te,se,s,{closeModal:3})}}function de(e){let a,s;return a=new re({props:{closeModal:e[7]}}),{c(){C(a.$$.fragment)},l(e){q(a.$$.fragment,e)},m(e,t){A(a,e,t),s=!0},p:S,i(e){s||(f(a.$$.fragment,e),s=!0)},o(e){p(a.$$.fragment,e),s=!1},d(e){N(a,e)}}}function ne(e){let a,s,t="general"==e[5]&&de(e);return{c(){t&&t.c(),a=v()},l(e){t&&t.l(e),a=v()},m(e,r){t&&t.m(e,r),l(e,a,r),s=!0},p(e,s){"general"==e[5]?t?(t.p(e,s),32&s&&f(t,1)):(t=de(e),t.c(),f(t,1),t.m(a.parentNode,a)):t&&(m(),p(t,1,1,(()=>{t=null})),g())},i(e){s||(f(t),s=!0)},o(e){p(t),s=!1},d(e){t&&t.d(e),e&&n(a)}}}function oe(e){let a,s,u,h,v,m,g,b,y,w,D,E,$,S,k,B,H,P,O,G,F,J,W,j,z,K,L,Q,X,Y,Z,_,ee,ae,se,te,re,de,oe,le,ce,ie,ue,he,fe,pe,ve,me,ge,be,ye,we,xe,Me,Te,Ie,De,Ee,$e,Se,ke,Be,Ce,Ve=e[6].serial+"",qe=e[6].baseAddr+"";return s=new U({props:{showModal:e[4],$$slots:{default:[ne]},$$scope:{ctx:e}}}),s.$on("click",e[9]),{c(){a=M(),C(s.$$.fragment),u=M(),h=t("section"),v=t("h3"),m=x("General"),g=M(),b=t("br"),y=M(),w=t("div"),D=t("div"),E=x("Serial"),$=M(),S=t("div"),k=x(Ve),B=M(),H=t("div"),P=t("div"),O=x("Base Address"),G=M(),F=t("div"),J=x(qe),W=M(),j=t("br"),z=M(),K=t("br"),L=M(),Q=t("section"),X=t("h3"),Y=x("Board Details"),Z=M(),_=t("br"),ee=M(),ae=t("div"),se=t("div"),te=x("PCB Type"),re=M(),de=t("div"),oe=x(e[0]),le=M(),ce=t("div"),ie=t("div"),ue=x("Software Version"),he=M(),fe=t("div"),pe=x(e[1]),ve=M(),me=t("div"),ge=t("div"),be=x("Software Checksum"),ye=M(),we=t("div"),xe=x(e[2]),Me=M(),Te=t("div"),Ie=t("div"),De=x("Software Date"),Ee=M(),$e=t("div"),Se=x(e[3]),this.h()},l(t){V('[data-svelte="svelte-ghgayl"]',document.head).forEach(n),a=I(t),q(s.$$.fragment,t),u=I(t),h=r(t,"SECTION",{class:!0});var o=d(h);v=r(o,"H3",{class:!0});var l=d(v);m=T(l,"General"),l.forEach(n),g=I(o),b=r(o,"BR",{}),y=I(o),w=r(o,"DIV",{class:!0});var c=d(w);D=r(c,"DIV",{});var i=d(D);E=T(i,"Serial"),i.forEach(n),$=I(c),S=r(c,"DIV",{});var f=d(S);k=T(f,Ve),f.forEach(n),c.forEach(n),B=I(o),H=r(o,"DIV",{class:!0});var p=d(H);P=r(p,"DIV",{});var x=d(P);O=T(x,"Base Address"),x.forEach(n),G=I(p),F=r(p,"DIV",{});var M=d(F);J=T(M,qe),M.forEach(n),p.forEach(n),o.forEach(n),W=I(t),j=r(t,"BR",{}),z=I(t),K=r(t,"BR",{}),L=I(t),Q=r(t,"SECTION",{class:!0});var C=d(Q);X=r(C,"H3",{class:!0});var A=d(X);Y=T(A,"Board Details"),A.forEach(n),Z=I(C),_=r(C,"BR",{}),ee=I(C),ae=r(C,"DIV",{class:!0});var R=d(ae);se=r(R,"DIV",{});var N=d(se);te=T(N,"PCB Type"),N.forEach(n),re=I(R),de=r(R,"DIV",{});var U=d(de);oe=T(U,e[0]),U.forEach(n),R.forEach(n),le=I(C),ce=r(C,"DIV",{class:!0});var ne=d(ce);ie=r(ne,"DIV",{});var ke=d(ie);ue=T(ke,"Software Version"),ke.forEach(n),he=I(ne),fe=r(ne,"DIV",{});var Be=d(fe);pe=T(Be,e[1]),Be.forEach(n),ne.forEach(n),ve=I(C),me=r(C,"DIV",{class:!0});var Ce=d(me);ge=r(Ce,"DIV",{});var Ae=d(ge);be=T(Ae,"Software Checksum"),Ae.forEach(n),ye=I(Ce),we=r(Ce,"DIV",{});var Re=d(we);xe=T(Re,e[2]),Re.forEach(n),Ce.forEach(n),Me=I(C),Te=r(C,"DIV",{class:!0});var Ne=d(Te);Ie=r(Ne,"DIV",{});var He=d(Ie);De=T(He,"Software Date"),He.forEach(n),Ee=I(Ne),$e=r(Ne,"DIV",{});var Pe=d($e);Se=T(Pe,e[3]),Pe.forEach(n),Ne.forEach(n),C.forEach(n),this.h()},h(){document.title="Service Tool Prototype",o(v,"class","svelte-17w87q2"),o(w,"class","row svelte-17w87q2"),o(H,"class","row svelte-17w87q2"),o(h,"class","svelte-17w87q2"),o(X,"class","svelte-17w87q2"),o(ae,"class","row svelte-17w87q2"),o(ce,"class","row svelte-17w87q2"),o(me,"class","row svelte-17w87q2"),o(Te,"class","row svelte-17w87q2"),o(Q,"class","svelte-17w87q2")},m(t,r){l(t,a,r),A(s,t,r),l(t,u,r),l(t,h,r),c(h,v),c(v,m),c(h,g),c(h,b),c(h,y),c(h,w),c(w,D),c(D,E),c(w,$),c(w,S),c(S,k),c(h,B),c(h,H),c(H,P),c(P,O),c(H,G),c(H,F),c(F,J),l(t,W,r),l(t,j,r),l(t,z,r),l(t,K,r),l(t,L,r),l(t,Q,r),c(Q,X),c(X,Y),c(Q,Z),c(Q,_),c(Q,ee),c(Q,ae),c(ae,se),c(se,te),c(ae,re),c(ae,de),c(de,oe),c(Q,le),c(Q,ce),c(ce,ie),c(ie,ue),c(ce,he),c(ce,fe),c(fe,pe),c(Q,ve),c(Q,me),c(me,ge),c(ge,be),c(me,ye),c(me,we),c(we,xe),c(Q,Me),c(Q,Te),c(Te,Ie),c(Ie,De),c(Te,Ee),c(Te,$e),c($e,Se),ke=!0,Be||(Ce=i(h,"click",e[10]),Be=!0)},p(e,[a]){const t={};16&a&&(t.showModal=e[4]),2080&a&&(t.$$scope={dirty:a,ctx:e}),s.$set(t),(!ke||64&a)&&Ve!==(Ve=e[6].serial+"")&&R(k,Ve),(!ke||64&a)&&qe!==(qe=e[6].baseAddr+"")&&R(J,qe),(!ke||1&a)&&R(oe,e[0]),(!ke||2&a)&&R(pe,e[1]),(!ke||4&a)&&R(xe,e[2]),(!ke||8&a)&&R(Se,e[3])},i(e){ke||(f(s.$$.fragment,e),ke=!0)},o(e){p(s.$$.fragment,e),ke=!1},d(e){e&&n(a),N(s,e),e&&n(u),e&&n(h),e&&n(W),e&&n(j),e&&n(z),e&&n(K),e&&n(L),e&&n(Q),Be=!1,Ce()}}}function le(e,a,s){let t;B(e,j,(e=>s(6,t=e)));let r="",d="",n="",o="",l=!1,c="general";H((async()=>{await ae();try{let e=await Z.serial({addr:255});j.setSerial(e),console.log(e);let a=await Z.baseSettings({addr:255});j.setBaseAddr(a.baseAddr),j.setChannelIndex(a.channelIndex),j.setTotalChannels(a.totalChannels);let t=await Z.pcbType({addr:255});s(0,r=t.pcbType);let l=await _.program({addr:255});s(1,d=l.version),s(2,n=l.checksum);let c=await _.programDate({addr:255});s(3,o=c)}catch(e){console.log(e)}}));let i=()=>{s(4,l=!1)},u=e=>{s(4,l=!0),s(5,c=e)};return[r,d,n,o,l,c,t,i,u,()=>{i()},()=>{u("general")}]}export default class extends e{constructor(e){super(),a(this,e,le,oe,s,{})}}
