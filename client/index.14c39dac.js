import{S as e,i as s,s as a,e as t,c as r,a as n,d as l,b as d,f as c,g as o,l as i,h as u,u as h,t as f,j as v,k as p,m,n as b,o as g,p as x,w,q as y,r as M,v as I,x as E,y as T,z as $,A as D,B as S,C as B,D as k,E as V,F as q,G as A,H as C,I as N,J as R,K as H}from"./client.22fbef0c.js";function P(e){let s,a,p,m,b;const x=e[2].default,w=g(x,e,e[1],null);return{c(){s=t("div"),a=t("div"),w&&w.c(),this.h()},l(e){s=r(e,"DIV",{class:!0});var t=n(s);a=r(t,"DIV",{class:!0});var d=n(a);w&&w.l(d),d.forEach(l),t.forEach(l),this.h()},h(){d(a,"class","modal svelte-y6bmyh"),d(s,"class","backdrop svelte-y6bmyh")},m(t,r){c(t,s,r),o(s,a),w&&w.m(a,null),p=!0,m||(b=i(s,"click",u(e[3])),m=!0)},p(e,s){w&&w.p&&2&s&&h(w,x,e,e[1],s,null,null)},i(e){p||(f(w,e),p=!0)},o(e){v(w,e),p=!1},d(e){e&&l(s),w&&w.d(e),m=!1,b()}}}function O(e){let s,a,t=e[0]&&P(e);return{c(){t&&t.c(),s=p()},l(e){t&&t.l(e),s=p()},m(e,r){t&&t.m(e,r),c(e,s,r),a=!0},p(e,[a]){e[0]?t?(t.p(e,a),1&a&&f(t,1)):(t=P(e),t.c(),f(t,1),t.m(s.parentNode,s)):t&&(m(),v(t,1,1,(()=>{t=null})),b())},i(e){a||(f(t),a=!0)},o(e){v(t),a=!1},d(e){t&&t.d(e),e&&l(s)}}}function G(e,s,a){let{$$slots:t={},$$scope:r}=s,{showModal:n=!1}=s;return e.$$set=e=>{"showModal"in e&&a(0,n=e.showModal),"$$scope"in e&&a(1,r=e.$$scope)},[n,r,t,function(s){x(e,s)}]}class U extends e{constructor(e){super(),s(this,e,G,O,a,{showModal:0})}}const{subscribe:F,set:J,update:W}=w({serial:"",baseAddr:"",channelIndex:"",totalChannels:"",randomFact:"Svelte can be easy"}),j={subscribe:F,set:J,update:W,setSerial:e=>W((s=>(s.serial=e,s))),setBaseAddr:e=>W((s=>(s.baseAddr=e,s))),setChannelIndex:e=>W((s=>(s.channelIndex=e,s))),setTotalChannels:e=>W((s=>(s.totalChannels=e,s)))},z=e=>{let s="Not Specified";if(!Number.isInteger(e))throw"type provided not valid integer";switch(e){case 1:s="T750 Hub";break;case 2:s="T750 Ann";break;case 3:s="T750 I/O";break;case 4:s="T750 Display";break;case 5:s="T750 Sampler";break;case 6:s="T650 Hub";break;case 7:s="T750B";break;case 8:s="T750B Display";break;case 9:s="T750BAV Display";break;case 10:s="T635 Display";break;case 11:s="T635+ Mini Hub (B1)";break;case 12:s="T635 Micro Mini Hub (B2)";break;case 13:s="T635 Mini Hub (B3)";break;case 14:s="T635 Mini Hub (B4)";break;case 15:s="ESP32 Dongle";break;case 16:s="T750+ Hub"}return s};var K;function L(e){console.log("Connection closed"),setTimeout(initWebSocket,2e3)}function Q(e){X.onMsgArrived(e)}const X={queuedMsgs:[],sentMsgs:[],busy:!1,onMsgArrived:function(e){let s=0,a=JSON.parse(e.data);this.sentMsgs.forEach((function(e,t){e.id===a.id&&(e.success(a),s=e.id)})),this.sentMsgs=this.sentMsgs.filter((e=>e.id!==s)),0!=this.queuedMsgs.length&&this.sendNextMessage()},init:function(){setInterval((()=>{let e=Date.now();this.sentMsgs.forEach((function(s,a){s.timestamp-e>5e3&&s.fail("No response received, expired: ",s)})),this.sentMsgs=this.sentMsgs.filter((s=>s.timestamp-e<5e3))}),800)},queueMsg:function(e){return new Promise(((s,a)=>{this.queuedMsgs.push({id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var s=16*Math.random()|0;return("x"==e?s:3&s|8).toString(16)})),timestamp:-1,msg:e,success:e=>{s(e)},fail:e=>{a(e)}}),this.sendNextMsg()}))},sendNextMsg:function(){if(this.queuedMsgs.length&&!this.busy){this.busy=!0;let e=this.queuedMsgs.shift();K.send(JSON.stringify({id:e.id,maxTries:e.msg.maxTries,timeout:e.msg.timeout,addr:e.msg.addr,cmd:e.msg.cmd,d1:e.msg.d1,d2:e.msg.d2,d3:e.msg.d3,d4:e.msg.d4})),this.sentMsgs.push(e),this.busy=!1}}},Y={serial:async function(e){let s=await X.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:21,d1:7,d2:0,d3:0,d4:0});if(0!=s.twResCode)throw s;return function(e,s,a){let t,r=0;return r|=a<<16,t=s,t=t<<8&65280,r|=t,r|=255&e,r}(s.payload.d1,s.payload.d2,s.payload.d3)},baseSettings:async function(e){let s=await X.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:21,d1:25,d2:0,d3:0,d4:0});if(0!=s.twResCode)throw s;return{baseAddr:s.payload.d1,channelIndex:s.payload.d2,totalChannels:s.payload.d3}},pcbType:async function(e){let s=await X.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:21,d1:37,d2:0,d3:0,d4:0});if(0!=s.twResCode)throw s;return{pcbType:z(s.payload.d1),addr:s.payload.d2,cable:s.payload.d3}}},Z={serial:async function(e){let s=function(e){let s=new Uint8Array(3);return s[0]=255&e,s[1]=e>>8&255,s[2]=e>>16&255,s}(e.serial),a=await X.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:121,d1:7,d2:s[0],d3:s[1],d4:s[2]});if(0!=a.twResCode)throw a},baseSettings:async function(e){let s=await X.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:121,d1:25,d2:e.baseAddr,d3:e.channelIndex,d4:e.totalChannels});if(0!=s.twResCode)throw s}};async function _(){await(console.log("Trying to open a WebSocket connection..."),(K=new WebSocket("wss://igd-dev.tk/chat")).onclose=L,K.onmessage=Q,new Promise(((e,s)=>{K.onopen=s=>{e(s)}}))),X.init()}function ee(e){let s,a,u,h,f,v,p,m,b,g,x,w,k,V,q,A,C,N,R,H,P,O,G,U,F,J,W;return{c(){s=t("h3"),a=y("General"),u=M(),h=t("br"),f=M(),v=t("br"),p=M(),m=t("form"),b=t("div"),g=t("div"),x=y("Serial"),w=M(),k=t("input"),V=M(),q=t("div"),A=y("Base Address"),C=M(),N=t("input"),R=M(),H=t("br"),P=M(),O=t("br"),G=M(),U=t("button"),F=y("Apply"),this.h()},l(e){s=r(e,"H3",{class:!0});var t=n(s);a=I(t,"General"),t.forEach(l),u=E(e),h=r(e,"BR",{}),f=E(e),v=r(e,"BR",{}),p=E(e),m=r(e,"FORM",{class:!0});var d=n(m);b=r(d,"DIV",{class:!0});var c=n(b);g=r(c,"DIV",{class:!0});var o=n(g);x=I(o,"Serial"),o.forEach(l),w=E(c),k=r(c,"INPUT",{type:!0,class:!0}),V=E(c),q=r(c,"DIV",{class:!0});var i=n(q);A=I(i,"Base Address"),i.forEach(l),C=E(c),N=r(c,"INPUT",{type:!0,class:!0}),c.forEach(l),R=E(d),H=r(d,"BR",{}),P=E(d),O=r(d,"BR",{}),G=E(d),U=r(d,"BUTTON",{type:!0,class:!0});var y=n(U);F=I(y,"Apply"),y.forEach(l),d.forEach(l),this.h()},h(){d(s,"class","svelte-111vfxd"),d(g,"class","svelte-111vfxd"),d(k,"type","number"),d(k,"class","svelte-111vfxd"),d(q,"class","svelte-111vfxd"),d(N,"type","number"),d(N,"class","svelte-111vfxd"),d(b,"class","inputs svelte-111vfxd"),d(U,"type","submit"),d(U,"class","svelte-111vfxd"),d(m,"class","svelte-111vfxd")},m(t,r){c(t,s,r),o(s,a),c(t,u,r),c(t,h,r),c(t,f,r),c(t,v,r),c(t,p,r),c(t,m,r),o(m,b),o(b,g),o(g,x),o(b,w),o(b,k),T(k,e[0]),o(b,V),o(b,q),o(q,A),o(b,C),o(b,N),T(N,e[1]),o(m,R),o(m,H),o(m,P),o(m,O),o(m,G),o(m,U),o(U,F),J||(W=[i(k,"input",e[4]),i(N,"input",e[5]),i(m,"submit",$(e[2]))],J=!0)},p(e,[s]){1&s&&D(k.value)!==e[0]&&T(k,e[0]),2&s&&D(N.value)!==e[1]&&T(N,e[1])},i:S,o:S,d(e){e&&l(s),e&&l(u),e&&l(h),e&&l(f),e&&l(v),e&&l(p),e&&l(m),J=!1,B(W)}}}function se(e,s,a){let t;k(e,j,(e=>a(6,t=e)));let r=t.serial,n=t.baseAddr,l=t.channelIndex,d=t.totalChannels,{closeModal:c}=s;return e.$$set=e=>{"closeModal"in e&&a(3,c=e.closeModal)},[r,n,async()=>{try{await Z.serial({addr:255,serial:r}),j.setSerial(r),await Z.baseSettings({addr:255,baseAddr:n,channelIndex:l,totalChannels:d}),j.setBaseAddr(n)}catch(e){console.log(e)}c()},c,function(){r=D(this.value),a(0,r)},function(){n=D(this.value),a(1,n)}]}class ae extends e{constructor(e){super(),s(this,e,se,ee,a,{closeModal:3})}}function te(e){let s,a;return s=new ae({props:{closeModal:e[3]}}),{c(){V(s.$$.fragment)},l(e){A(s.$$.fragment,e)},m(e,t){C(s,e,t),a=!0},p:S,i(e){a||(f(s.$$.fragment,e),a=!0)},o(e){v(s.$$.fragment,e),a=!1},d(e){R(s,e)}}}function re(e){let s,a,t="general"==e[1]&&te(e);return{c(){t&&t.c(),s=p()},l(e){t&&t.l(e),s=p()},m(e,r){t&&t.m(e,r),c(e,s,r),a=!0},p(e,a){"general"==e[1]?t?(t.p(e,a),2&a&&f(t,1)):(t=te(e),t.c(),f(t,1),t.m(s.parentNode,s)):t&&(m(),v(t,1,1,(()=>{t=null})),b())},i(e){a||(f(t),a=!0)},o(e){v(t),a=!1},d(e){t&&t.d(e),e&&l(s)}}}function ne(e){let s,a,u,h,p,m,b,g,x,w,T,$,D,S,B,k,H,P,O,G,F,J,W,j,z,K,L,Q,X,Y,Z,_,ee,se,ae,te,ne,ie,ue,he,fe,ve,pe,me,be,ge,xe,we,ye,Me,Ie,Ee,Te,$e,De,Se,Be,ke,Ve,qe,Ae,Ce,Ne,Re=e[2].serial+"",He=e[2].baseAddr+"";return a=new U({props:{showModal:e[0],$$slots:{default:[re]},$$scope:{ctx:e}}}),a.$on("click",e[5]),{c(){s=M(),V(a.$$.fragment),u=M(),h=t("section"),p=t("h3"),m=y("General"),b=M(),g=t("br"),x=M(),w=t("div"),T=t("div"),$=y("Serial"),D=M(),S=t("div"),B=y(Re),k=M(),H=t("div"),P=t("div"),O=y("Base Address"),G=M(),F=t("div"),J=y(He),W=M(),j=t("br"),z=M(),K=t("br"),L=M(),Q=t("section"),X=t("h3"),Y=y("Board Details"),Z=M(),_=t("br"),ee=M(),se=t("div"),ae=t("div"),te=y("PCB Type"),ne=M(),ie=t("div"),ue=y(le),he=M(),fe=t("div"),ve=t("div"),pe=y("Software Version"),me=M(),be=t("div"),ge=y(de),xe=M(),we=t("div"),ye=t("div"),Me=y("Software Checksum"),Ie=M(),Ee=t("div"),Te=y(ce),$e=M(),De=t("div"),Se=t("div"),Be=y("Software Date"),ke=M(),Ve=t("div"),qe=y(oe),this.h()},l(e){q('[data-svelte="svelte-ghgayl"]',document.head).forEach(l),s=E(e),A(a.$$.fragment,e),u=E(e),h=r(e,"SECTION",{class:!0});var t=n(h);p=r(t,"H3",{class:!0});var d=n(p);m=I(d,"General"),d.forEach(l),b=E(t),g=r(t,"BR",{}),x=E(t),w=r(t,"DIV",{class:!0});var c=n(w);T=r(c,"DIV",{});var o=n(T);$=I(o,"Serial"),o.forEach(l),D=E(c),S=r(c,"DIV",{});var i=n(S);B=I(i,Re),i.forEach(l),c.forEach(l),k=E(t),H=r(t,"DIV",{class:!0});var f=n(H);P=r(f,"DIV",{});var v=n(P);O=I(v,"Base Address"),v.forEach(l),G=E(f),F=r(f,"DIV",{});var y=n(F);J=I(y,He),y.forEach(l),f.forEach(l),t.forEach(l),W=E(e),j=r(e,"BR",{}),z=E(e),K=r(e,"BR",{}),L=E(e),Q=r(e,"SECTION",{class:!0});var M=n(Q);X=r(M,"H3",{class:!0});var V=n(X);Y=I(V,"Board Details"),V.forEach(l),Z=E(M),_=r(M,"BR",{}),ee=E(M),se=r(M,"DIV",{class:!0});var C=n(se);ae=r(C,"DIV",{});var N=n(ae);te=I(N,"PCB Type"),N.forEach(l),ne=E(C),ie=r(C,"DIV",{});var R=n(ie);ue=I(R,le),R.forEach(l),C.forEach(l),he=E(M),fe=r(M,"DIV",{class:!0});var U=n(fe);ve=r(U,"DIV",{});var re=n(ve);pe=I(re,"Software Version"),re.forEach(l),me=E(U),be=r(U,"DIV",{});var Ae=n(be);ge=I(Ae,de),Ae.forEach(l),U.forEach(l),xe=E(M),we=r(M,"DIV",{class:!0});var Ce=n(we);ye=r(Ce,"DIV",{});var Ne=n(ye);Me=I(Ne,"Software Checksum"),Ne.forEach(l),Ie=E(Ce),Ee=r(Ce,"DIV",{});var Pe=n(Ee);Te=I(Pe,ce),Pe.forEach(l),Ce.forEach(l),$e=E(M),De=r(M,"DIV",{class:!0});var Oe=n(De);Se=r(Oe,"DIV",{});var Ge=n(Se);Be=I(Ge,"Software Date"),Ge.forEach(l),ke=E(Oe),Ve=r(Oe,"DIV",{});var Ue=n(Ve);qe=I(Ue,oe),Ue.forEach(l),Oe.forEach(l),M.forEach(l),this.h()},h(){document.title="Service Tool Prototype",d(p,"class","svelte-17w87q2"),d(w,"class","row svelte-17w87q2"),d(H,"class","row svelte-17w87q2"),d(h,"class","svelte-17w87q2"),d(X,"class","svelte-17w87q2"),d(se,"class","row svelte-17w87q2"),d(fe,"class","row svelte-17w87q2"),d(we,"class","row svelte-17w87q2"),d(De,"class","row svelte-17w87q2"),d(Q,"class","svelte-17w87q2")},m(t,r){c(t,s,r),C(a,t,r),c(t,u,r),c(t,h,r),o(h,p),o(p,m),o(h,b),o(h,g),o(h,x),o(h,w),o(w,T),o(T,$),o(w,D),o(w,S),o(S,B),o(h,k),o(h,H),o(H,P),o(P,O),o(H,G),o(H,F),o(F,J),c(t,W,r),c(t,j,r),c(t,z,r),c(t,K,r),c(t,L,r),c(t,Q,r),o(Q,X),o(X,Y),o(Q,Z),o(Q,_),o(Q,ee),o(Q,se),o(se,ae),o(ae,te),o(se,ne),o(se,ie),o(ie,ue),o(Q,he),o(Q,fe),o(fe,ve),o(ve,pe),o(fe,me),o(fe,be),o(be,ge),o(Q,xe),o(Q,we),o(we,ye),o(ye,Me),o(we,Ie),o(we,Ee),o(Ee,Te),o(Q,$e),o(Q,De),o(De,Se),o(Se,Be),o(De,ke),o(De,Ve),o(Ve,qe),Ae=!0,Ce||(Ne=i(h,"click",e[6]),Ce=!0)},p(e,[s]){const t={};1&s&&(t.showModal=e[0]),130&s&&(t.$$scope={dirty:s,ctx:e}),a.$set(t),(!Ae||4&s)&&Re!==(Re=e[2].serial+"")&&N(B,Re),(!Ae||4&s)&&He!==(He=e[2].baseAddr+"")&&N(J,He)},i(e){Ae||(f(a.$$.fragment,e),Ae=!0)},o(e){v(a.$$.fragment,e),Ae=!1},d(e){e&&l(s),R(a,e),e&&l(u),e&&l(h),e&&l(W),e&&l(j),e&&l(z),e&&l(K),e&&l(L),e&&l(Q),Ce=!1,Ne()}}}let le="",de="",ce="",oe="";function ie(e,s,a){let t;k(e,j,(e=>a(2,t=e)));let r=!1,n="general";H((async()=>{await _();try{let e=await Y.serial({addr:255});j.setSerial(e)}catch(e){console.log(e)}}));let l=()=>{a(0,r=!1)},d=e=>{a(0,r=!0),a(1,n=e)};return[r,n,t,l,d,()=>{l()},()=>{d("general")}]}export default class extends e{constructor(e){super(),s(this,e,ie,ne,a,{})}}
