import{S as e,i as a,s,e as t,c as r,a as d,d as o,b as n,f as l,g as c,l as i,h as u,u as h,t as f,j as v,k as p,m,n as g,o as w,p as x,w as b,q as y,r as M,v as D,x as T,y as E,z as I,A as $,B as S,C as B,D as k,E as V,F as q,G as C,H as A,I as R,J as N,K as H}from"./client.8063079b.js";function O(e){let a,s,p,m,g;const x=e[2].default,b=w(x,e,e[1],null);return{c(){a=t("div"),s=t("div"),b&&b.c(),this.h()},l(e){a=r(e,"DIV",{class:!0});var t=d(a);s=r(t,"DIV",{class:!0});var n=d(s);b&&b.l(n),n.forEach(o),t.forEach(o),this.h()},h(){n(s,"class","modal svelte-y6bmyh"),n(a,"class","backdrop svelte-y6bmyh")},m(t,r){l(t,a,r),c(a,s),b&&b.m(s,null),p=!0,m||(g=i(a,"click",u(e[3])),m=!0)},p(e,a){b&&b.p&&2&a&&h(b,x,e,e[1],a,null,null)},i(e){p||(f(b,e),p=!0)},o(e){v(b,e),p=!1},d(e){e&&o(a),b&&b.d(e),m=!1,g()}}}function P(e){let a,s,t=e[0]&&O(e);return{c(){t&&t.c(),a=p()},l(e){t&&t.l(e),a=p()},m(e,r){t&&t.m(e,r),l(e,a,r),s=!0},p(e,[s]){e[0]?t?(t.p(e,s),1&s&&f(t,1)):(t=O(e),t.c(),f(t,1),t.m(a.parentNode,a)):t&&(m(),v(t,1,1,(()=>{t=null})),g())},i(e){s||(f(t),s=!0)},o(e){v(t),s=!1},d(e){t&&t.d(e),e&&o(a)}}}function G(e,a,s){let{$$slots:t={},$$scope:r}=a,{showModal:d=!1}=a;return e.$$set=e=>{"showModal"in e&&s(0,d=e.showModal),"$$scope"in e&&s(1,r=e.$$scope)},[d,r,t,function(a){x(e,a)}]}class U extends e{constructor(e){super(),a(this,e,G,P,s,{showModal:0})}}const{subscribe:j,set:F,update:J}=b({serial:"",baseAddr:"",channelIndex:"",totalChannels:"",randomFact:"Svelte can be easy"}),W={subscribe:j,set:F,update:J,setSerial:e=>J((a=>(a.serial=e,a))),setBaseAddr:e=>J((a=>(a.baseAddr=e,a))),setChannelIndex:e=>J((a=>(a.channelIndex=e,a))),setTotalChannels:e=>J((a=>(a.totalChannels=e,a)))},z=e=>{let a="Not Specified";if(!Number.isInteger(e))throw"type provided not valid integer";switch(e){case 1:a="T750 Hub";break;case 2:a="T750 Ann";break;case 3:a="T750 I/O";break;case 4:a="T750 Display";break;case 5:a="T750 Sampler";break;case 6:a="T650 Hub";break;case 7:a="T750B";break;case 8:a="T750B Display";break;case 9:a="T750BAV Display";break;case 10:a="T635 Display";break;case 11:a="T635+ Mini Hub (B1)";break;case 12:a="T635 Micro Mini Hub (B2)";break;case 13:a="T635 Mini Hub (B3)";break;case 14:a="T635 Mini Hub (B4)";break;case 15:a="ESP32 Dongle";break;case 16:a="T750+ Hub"}return a};function K(e,a){let s=0;return s|=a<<8,s|=e,s}var L;function Q(e){console.log("Connection closed"),setTimeout(Y,2e3)}function X(e){Z.onMsgArrived(e)}function Y(){return console.log("Trying to open a WebSocket connection..."),(L=new WebSocket("wss://igd-dev.tk/chat")).onclose=Q,L.onmessage=X,new Promise(((e,a)=>{L.onopen=a=>{e(a)}}))}const Z={queuedMsgs:[],sentMsgs:[],busy:!1,onMsgArrived:function(e){let a=0,s=JSON.parse(e.data);console.log("rxMsgData: ",s),this.sentMsgs.forEach((function(e,t){e.id===s.id&&(e.success(s),a=e.id)})),this.sentMsgs=this.sentMsgs.filter((e=>e.id!==a)),0!=this.queuedMsgs.length&&this.sendNextMessage()},init:function(){setInterval((()=>{let e=Date.now();this.sentMsgs.forEach((function(a,s){a.timestamp-e>5e3&&a.fail("No response received, expired: ",a)})),this.sentMsgs=this.sentMsgs.filter((a=>a.timestamp-e<5e3))}),800)},queueMsg:function(e){return new Promise(((a,s)=>{this.queuedMsgs.push({id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var a=16*Math.random()|0;return("x"==e?a:3&a|8).toString(16)})),timestamp:-1,msg:e,success:e=>{console.log("resolved: ",e),a(e)},fail:e=>{console.log("rejected: ",e),s(e)}}),this.sendNextMsg()}))},sendNextMsg:function(){if(this.queuedMsgs.length&&!this.busy){this.busy=!0;let e=this.queuedMsgs.shift();L.send(JSON.stringify({id:e.id,maxTries:e.msg.maxTries,timeout:e.msg.timeout,addr:e.msg.addr,cmd:e.msg.cmd,d1:e.msg.d1,d2:e.msg.d2,d3:e.msg.d3,d4:e.msg.d4})),this.sentMsgs.push(e),this.busy=!1}}},_={serial:async function(e){let a=await Z.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:21,d1:7,d2:0,d3:0,d4:0});if(console.log("serial res: ",a),0!=a.twResCode)throw a;return function(e,a,s){let t,r=0;return r|=s<<16,t=a,t=t<<8&65280,r|=t,r|=255&e,r}(a.payload.d1,a.payload.d2,a.payload.d3)},baseSettings:async function(e){let a=await Z.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:21,d1:25,d2:0,d3:0,d4:0});if(0!=a.twResCode)throw a;return{baseAddr:a.payload.d1,channelIndex:a.payload.d2,totalChannels:a.payload.d3}},pcbType:async function(e){let a=await Z.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:21,d1:37,d2:0,d3:0,d4:0});if(0!=a.twResCode)throw a;return{pcbType:z(a.payload.d1),addr:a.payload.d2,cable:a.payload.d3}}},ee={program:async function(e){let a=await Z.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:20,d1:1,d2:0,d3:0,d4:0});if(0!=a.twResCode)throw a;return{version:K(a.payload.d1,a.payload.d2)/1e3,checksum:`0x${K(a.payload.d3,a.payload.d4).toString(16).toUpperCase()}`}},programDate:async function(e){let a=await Z.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:20,d1:4,d2:0,d3:0,d4:0});if(0!=a.twResCode)throw a;return new Date(a.payload.d3+2e3,a.payload.d2-1,a.payload.d1).toLocaleDateString()}},ae={serial:async function(e){let a=function(e){let a=new Uint8Array(3);return a[0]=255&e,a[1]=e>>8&255,a[2]=e>>16&255,a}(e.serial),s=await Z.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:121,d1:7,d2:a[0],d3:a[1],d4:a[2]});if(0!=s.twResCode)throw s},baseSettings:async function(e){let a=await Z.queueMsg({maxTries:3,timeout:100,addr:e.addr,cmd:121,d1:25,d2:e.baseAddr,d3:e.channelIndex,d4:e.totalChannels});if(0!=a.twResCode)throw a}};function se(e){let a,s,u,h,f,v,p,m,g,w,x,b,k,V,q,C,A,R,N,H,O,P,G,U,j,F,J;return{c(){a=t("h3"),s=y("General"),u=M(),h=t("br"),f=M(),v=t("br"),p=M(),m=t("form"),g=t("div"),w=t("div"),x=y("Serial"),b=M(),k=t("input"),V=M(),q=t("div"),C=y("Base Address"),A=M(),R=t("input"),N=M(),H=t("br"),O=M(),P=t("br"),G=M(),U=t("button"),j=y("Apply"),this.h()},l(e){a=r(e,"H3",{class:!0});var t=d(a);s=D(t,"General"),t.forEach(o),u=T(e),h=r(e,"BR",{}),f=T(e),v=r(e,"BR",{}),p=T(e),m=r(e,"FORM",{class:!0});var n=d(m);g=r(n,"DIV",{class:!0});var l=d(g);w=r(l,"DIV",{class:!0});var c=d(w);x=D(c,"Serial"),c.forEach(o),b=T(l),k=r(l,"INPUT",{type:!0,class:!0}),V=T(l),q=r(l,"DIV",{class:!0});var i=d(q);C=D(i,"Base Address"),i.forEach(o),A=T(l),R=r(l,"INPUT",{type:!0,class:!0}),l.forEach(o),N=T(n),H=r(n,"BR",{}),O=T(n),P=r(n,"BR",{}),G=T(n),U=r(n,"BUTTON",{type:!0,class:!0});var y=d(U);j=D(y,"Apply"),y.forEach(o),n.forEach(o),this.h()},h(){n(a,"class","svelte-111vfxd"),n(w,"class","svelte-111vfxd"),n(k,"type","number"),n(k,"class","svelte-111vfxd"),n(q,"class","svelte-111vfxd"),n(R,"type","number"),n(R,"class","svelte-111vfxd"),n(g,"class","inputs svelte-111vfxd"),n(U,"type","submit"),n(U,"class","svelte-111vfxd"),n(m,"class","svelte-111vfxd")},m(t,r){l(t,a,r),c(a,s),l(t,u,r),l(t,h,r),l(t,f,r),l(t,v,r),l(t,p,r),l(t,m,r),c(m,g),c(g,w),c(w,x),c(g,b),c(g,k),E(k,e[0]),c(g,V),c(g,q),c(q,C),c(g,A),c(g,R),E(R,e[1]),c(m,N),c(m,H),c(m,O),c(m,P),c(m,G),c(m,U),c(U,j),F||(J=[i(k,"input",e[4]),i(R,"input",e[5]),i(m,"submit",I(e[2]))],F=!0)},p(e,[a]){1&a&&$(k.value)!==e[0]&&E(k,e[0]),2&a&&$(R.value)!==e[1]&&E(R,e[1])},i:S,o:S,d(e){e&&o(a),e&&o(u),e&&o(h),e&&o(f),e&&o(v),e&&o(p),e&&o(m),F=!1,B(J)}}}function te(e,a,s){let t;k(e,W,(e=>s(6,t=e)));let r=t.serial,d=t.baseAddr,o=t.channelIndex,n=t.totalChannels,{closeModal:l}=a;return e.$$set=e=>{"closeModal"in e&&s(3,l=e.closeModal)},[r,d,async()=>{try{await ae.serial({addr:255,serial:r}),W.setSerial(r),await ae.baseSettings({addr:255,baseAddr:d,channelIndex:o,totalChannels:n}),W.setBaseAddr(d)}catch(e){console.log(e)}l()},l,function(){r=$(this.value),s(0,r)},function(){d=$(this.value),s(1,d)}]}class re extends e{constructor(e){super(),a(this,e,te,se,s,{closeModal:3})}}function de(e){let a,s;return a=new re({props:{closeModal:e[4]}}),{c(){V(a.$$.fragment)},l(e){C(a.$$.fragment,e)},m(e,t){A(a,e,t),s=!0},p:S,i(e){s||(f(a.$$.fragment,e),s=!0)},o(e){v(a.$$.fragment,e),s=!1},d(e){N(a,e)}}}function oe(e){let a,s,t="general"==e[1]&&de(e);return{c(){t&&t.c(),a=p()},l(e){t&&t.l(e),a=p()},m(e,r){t&&t.m(e,r),l(e,a,r),s=!0},p(e,s){"general"==e[1]?t?(t.p(e,s),2&s&&f(t,1)):(t=de(e),t.c(),f(t,1),t.m(a.parentNode,a)):t&&(m(),v(t,1,1,(()=>{t=null})),g())},i(e){s||(f(t),s=!0)},o(e){v(t),s=!1},d(e){t&&t.d(e),e&&o(a)}}}function ne(e){let a,s,u,h,p,m,g,w,x,b,E,I,$,S,B,k,H,O,P,G,j,F,J,W,z,K,L,Q,X,Y,Z,_,ee,ae,se,te,re,de,ne,he,fe,ve,pe,me,ge,we,xe,be,ye,Me,De,Te,Ee,Ie,$e,Se,Be,ke,Ve,qe,Ce,Ae,Re,Ne=e[3].baseAddr+"";return s=new U({props:{showModal:e[0],$$slots:{default:[oe]},$$scope:{ctx:e}}}),s.$on("click",e[6]),{c(){a=M(),V(s.$$.fragment),u=M(),h=t("section"),p=t("h3"),m=y("General"),g=M(),w=t("br"),x=M(),b=t("div"),E=t("div"),I=y("Serial"),$=M(),S=t("div"),B=y(e[2]),k=M(),H=t("div"),O=t("div"),P=y("Base Address"),G=M(),j=t("div"),F=y(Ne),J=M(),W=t("br"),z=M(),K=t("br"),L=M(),Q=t("section"),X=t("h3"),Y=y("Board Details"),Z=M(),_=t("br"),ee=M(),ae=t("div"),se=t("div"),te=y("PCB Type"),re=M(),de=t("div"),ne=y(le),he=M(),fe=t("div"),ve=t("div"),pe=y("Software Version"),me=M(),ge=t("div"),we=y(ce),xe=M(),be=t("div"),ye=t("div"),Me=y("Software Checksum"),De=M(),Te=t("div"),Ee=y(ie),Ie=M(),$e=t("div"),Se=t("div"),Be=y("Software Date"),ke=M(),Ve=t("div"),qe=y(ue),this.h()},l(t){q('[data-svelte="svelte-ghgayl"]',document.head).forEach(o),a=T(t),C(s.$$.fragment,t),u=T(t),h=r(t,"SECTION",{class:!0});var n=d(h);p=r(n,"H3",{class:!0});var l=d(p);m=D(l,"General"),l.forEach(o),g=T(n),w=r(n,"BR",{}),x=T(n),b=r(n,"DIV",{class:!0});var c=d(b);E=r(c,"DIV",{});var i=d(E);I=D(i,"Serial"),i.forEach(o),$=T(c),S=r(c,"DIV",{});var f=d(S);B=D(f,e[2]),f.forEach(o),c.forEach(o),k=T(n),H=r(n,"DIV",{class:!0});var v=d(H);O=r(v,"DIV",{});var y=d(O);P=D(y,"Base Address"),y.forEach(o),G=T(v),j=r(v,"DIV",{});var M=d(j);F=D(M,Ne),M.forEach(o),v.forEach(o),n.forEach(o),J=T(t),W=r(t,"BR",{}),z=T(t),K=r(t,"BR",{}),L=T(t),Q=r(t,"SECTION",{class:!0});var V=d(Q);X=r(V,"H3",{class:!0});var A=d(X);Y=D(A,"Board Details"),A.forEach(o),Z=T(V),_=r(V,"BR",{}),ee=T(V),ae=r(V,"DIV",{class:!0});var R=d(ae);se=r(R,"DIV",{});var N=d(se);te=D(N,"PCB Type"),N.forEach(o),re=T(R),de=r(R,"DIV",{});var U=d(de);ne=D(U,le),U.forEach(o),R.forEach(o),he=T(V),fe=r(V,"DIV",{class:!0});var oe=d(fe);ve=r(oe,"DIV",{});var Ce=d(ve);pe=D(Ce,"Software Version"),Ce.forEach(o),me=T(oe),ge=r(oe,"DIV",{});var Ae=d(ge);we=D(Ae,ce),Ae.forEach(o),oe.forEach(o),xe=T(V),be=r(V,"DIV",{class:!0});var Re=d(be);ye=r(Re,"DIV",{});var He=d(ye);Me=D(He,"Software Checksum"),He.forEach(o),De=T(Re),Te=r(Re,"DIV",{});var Oe=d(Te);Ee=D(Oe,ie),Oe.forEach(o),Re.forEach(o),Ie=T(V),$e=r(V,"DIV",{class:!0});var Pe=d($e);Se=r(Pe,"DIV",{});var Ge=d(Se);Be=D(Ge,"Software Date"),Ge.forEach(o),ke=T(Pe),Ve=r(Pe,"DIV",{});var Ue=d(Ve);qe=D(Ue,ue),Ue.forEach(o),Pe.forEach(o),V.forEach(o),this.h()},h(){document.title="Service Tool Prototype",n(p,"class","svelte-17w87q2"),n(b,"class","row svelte-17w87q2"),n(H,"class","row svelte-17w87q2"),n(h,"class","svelte-17w87q2"),n(X,"class","svelte-17w87q2"),n(ae,"class","row svelte-17w87q2"),n(fe,"class","row svelte-17w87q2"),n(be,"class","row svelte-17w87q2"),n($e,"class","row svelte-17w87q2"),n(Q,"class","svelte-17w87q2")},m(t,r){l(t,a,r),A(s,t,r),l(t,u,r),l(t,h,r),c(h,p),c(p,m),c(h,g),c(h,w),c(h,x),c(h,b),c(b,E),c(E,I),c(b,$),c(b,S),c(S,B),c(h,k),c(h,H),c(H,O),c(O,P),c(H,G),c(H,j),c(j,F),l(t,J,r),l(t,W,r),l(t,z,r),l(t,K,r),l(t,L,r),l(t,Q,r),c(Q,X),c(X,Y),c(Q,Z),c(Q,_),c(Q,ee),c(Q,ae),c(ae,se),c(se,te),c(ae,re),c(ae,de),c(de,ne),c(Q,he),c(Q,fe),c(fe,ve),c(ve,pe),c(fe,me),c(fe,ge),c(ge,we),c(Q,xe),c(Q,be),c(be,ye),c(ye,Me),c(be,De),c(be,Te),c(Te,Ee),c(Q,Ie),c(Q,$e),c($e,Se),c(Se,Be),c($e,ke),c($e,Ve),c(Ve,qe),Ce=!0,Ae||(Re=i(h,"click",e[7]),Ae=!0)},p(e,[a]){const t={};1&a&&(t.showModal=e[0]),258&a&&(t.$$scope={dirty:a,ctx:e}),s.$set(t),(!Ce||4&a)&&R(B,e[2]),(!Ce||8&a)&&Ne!==(Ne=e[3].baseAddr+"")&&R(F,Ne)},i(e){Ce||(f(s.$$.fragment,e),Ce=!0)},o(e){v(s.$$.fragment,e),Ce=!1},d(e){e&&o(a),N(s,e),e&&o(u),e&&o(h),e&&o(J),e&&o(W),e&&o(z),e&&o(K),e&&o(L),e&&o(Q),Ae=!1,Re()}}}let le="",ce="",ie="",ue="";function he(e,a,s){let t;k(e,W,(e=>s(3,t=e)));let r=!1,d="general",o=-1;H((async()=>{try{await async function(){await Y(),Z.init()}()}catch(e){console.log("init error ws, twowire: ",e)}try{let e=await _.serial({addr:255});s(2,o=e);await _.baseSettings({addr:255}),await _.pcbType({addr:255}),await ee.program({addr:255}),await ee.programDate({addr:255})}catch(e){console.log("ERROR",e)}}));let n=()=>{s(0,r=!1)},l=e=>{s(0,r=!0),s(1,d=e)};return[r,d,o,t,n,l,()=>{n()},()=>{l("general")}]}export default class extends e{constructor(e){super(),a(this,e,he,ne,s,{})}}
